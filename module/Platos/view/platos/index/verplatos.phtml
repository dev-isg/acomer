<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
   <div class="content-left">
   		<div class="descrip-product">
   			<div class="etiqueta-cat">
   				<div class="etiqueta">
   					<p>Destacados - <span>Ceviche</span></p>
   				</div>
   			</div>
   			<div class="ficha-product">
   				<div class="ficha-img">
   					<img src="/img/ceviche.jpg">
   				</div>
   				<div class="ficha-desc">
                  <h2><?php echo $this->lista[0]['restaurant_nombre'];?></h2>
   					<div class="puntuaciones c<?php echo $this->lista[0]['ta_puntaje_in_id'];?>"></div>
                  <h3><?php echo $this->lista[0]['va_nombre'];?></h3>
   					<p class="desc"><?php echo $this->lista[0]['tx_descripcion'];?></p>
   					<p class="costo">Costo</p>
   					<p class="precio"><?php echo $this->lista[0]['va_precio'];?></p>
   				</div>
   			</div>
   			<div class="content-coments">
   				<div class="coments-all">
                  <div class="cont-accesorios">
                     <div class="left-desc">
                        <h4>Direcci처n</h4>
                        <ul class="ubi-lupa">
                           <li>
                              <div class="ubicancion"><?php echo $this->lista[0]['va_direccion'];?>-<?php echo $this->lista[0]['distrito'];?></div>
                              <!--<div class="ubicancion">Av. Javier Prado Este N째 1860. - San Borja</div>-->
                           </li>
                           <!--<li>
                              <div class="lupa"><a href="#">Ver mapa</a></div>
                           </li>-->
                        </ul>
                        <h4>Telefono</h4>
                        <ul class="servicios-desc">
                           <li>965-85687</li>
                        </ul>
                        <h4>Atenci처n</h4>
                        <ul class="time">
                           <li><span class="day"><?php echo $this->lista[0]['va_dia'];?></span></li>
                           <li><span class="hour"><?php echo $this->lista[0]['va_horario'];?></span></li>
                        </ul>
                     </div>
                     <div class="right-desc">
                        <h4>Medios de pago</h4>
                        <h4>Servicio</h4>
                        <ul class="servicios-desc">
                           <li>Acceso a discapasitados</li>
                           <li>Estacionamiento</li>
                           <li>Wi-fi</li>
                        </ul>
                     </div>
                  </div>
   					<div class="top-coment">
   						<p>7 comentarios realizados</p>
   						<a href="#" class="btn btn-warning agregar-coment-1">Agregar comentario</a>
   					</div>
   					<div class="agregar-comentario-desc" style="display:none;height:376px;">
   						<?php
							  $title = 'Agregar nuevo comentario';
							  $this->headTitle($title);
							?>
							<div class="form-envio-men">
   							<?php
   							$form = $this->form;
   							//$form->setAttribute('action', $this->url('usuario', array('action' => 'add')));
   							$form->setAttributes(array(
   							    'action' => $this->url.'/platos/index/verplatos?id='.$this->lista[0]['in_id'],//'/usuario/comentarios/agregarcomentarios',
   							    'method' => 'post',
   							    'class' => 'form-horizontal'
   							));
   							$form->prepare();


   							echo $this->form()->openTag($form);
   							?><legend><?php echo $this->escapeHtml($title); ?></legend>
   							<?php
   							echo $this->formHidden($form->get('in_id'));   
   							echo $this->formHidden($form->get('Ta_puntaje_in_id'));
   							echo $this->formHidden($form->get('Ta_plato_in_id'));
   							?>
   							<div class="control-group"><?php echo $this->formRow($form->get('va_nombre'));?></div>
   							<div class="control-group"><?php echo $this->formRow($form->get('va_email'));?></div>
   							<div class="control-group"><p id="star"></p> </div>
   							<div class="control-group"><?php echo $this->formRow($form->get('tx_descripcion'));?></div>
   							<div class="control-group"><?php echo $this->formSubmit($form->get('submit'));?></div>


   							 <?php echo $this->form()->closeTag(); ?>
   						</div>
   					</div>
   					<div class="comentarios-one">
   						<ul>
                        <?php  foreach ($this->comentarios  as $comt) : ?>
	   							<li>
	   								<div class="coment-li">
	   									<div class="img-li">
	   										<img src="/img/foto-carnet.jpg">
	   									</div>
	   									<div class="img-li-desc">
	   										<div class="img-li-top">
                                       <h4><?php echo $comt->va_nombre_cliente?></h3>
	   											<div class="puntuaciones c<?php echo $comt->ta_puntaje_in_id;?>"></div>
	   										</div>
	   										<div class="img-li-bottom">
	   											<p> <?php echo $comt->tx_descripcion?></p> 
	   										</div>
	   									</div>
	   								</div>
	   							</li>
                           <?php endforeach;?>
   						</ul>
   					</div>
   				</div>
   				<div class="content-info">
   					<div class="info-img">
   						<img src="/img/default-img.jpg">
   					</div>
                  <h4>Ubicaci처n</h4>
                  <div id="map" class="map" data-lat="-12.0976539" data-lng=" -77.06020960000001"></div>
   				</div>
   			</div>
   			
   		</div>
   </div>
<script type="text/javascript">
	$(document).ready(function(){
		$(".agregar-coment-1").click(function(e){
			e.preventDefault();
			if ($(".agregar-comentario-desc").is(":hidden")) {
		      $(".agregar-comentario-desc").show("slow");
		    } else {
		      $(".agregar-comentario-desc").slideUp();
		    }
		});

      initSucursales();

	});

   function initSucursales(){

      var populateMap;
      var mapDiv = document.getElementById('map');
      
      var lat = $("#map").data("lat");
      var lng = $("#map").data("lng");
      var markers = Array();
      
      // Defino Iconos
      var iconGray = new google.maps.MarkerImage(
               'http://3802ae1a904469d2facd-00f3436faa63827c55a80b5230ed9a51.r85.cf1.rackcdn.com/gMarkers-4.png',
               new google.maps.Size(24, 34), 
               new google.maps.Point(0, 0), 
               new google.maps.Point(24, 34) 
               );

      var iconRed = new google.maps.MarkerImage(
               'http://3802ae1a904469d2facd-00f3436faa63827c55a80b5230ed9a51.r85.cf1.rackcdn.com/gMarkers-4.png',
               new google.maps.Size(24, 34), 
               new google.maps.Point(24, 0), 
               new google.maps.Point(24, 34) 
               );
      
      
      var latlng = new google.maps.LatLng(lat, lng);
      
      var options = {
         center   : latlng,
         zoom: 17,
         mapTypeId: google.maps.MapTypeId.ROADMAP,
         backgroundColor: '#ffffff',
         disableDefaultUI: true,
         navigationControl: true,
         navigationControlOptions:{
            position : google.maps.ControlPosition.TOP_RIGHT,
            style    : google.maps.NavigationControlStyle.SMALL
         }
      };
      
      var map = new google.maps.Map(mapDiv, options);
      var lugares = Array();

      
      
      function createMarker(lugar, icono){
                  
         place=new google.maps.LatLng(lugar.lat,lugar.lng);

         var marker = new google.maps.Marker({
            icon: icono,
            position: place,
            map: map,
            title: lugar.title,           
            zIndex: 100          
         });
         i = lugar.index;
         (function(i, marker) {
            google.maps.event.addListener(marker, 'click', function() {
                  setActive(marker,i);
            });
         })(i, marker);
         return marker;
      }
         
      function populateMap(lugares){
         var infowindow;
         // Agregar todos los puntos al mapa
         for (var i = 0; i < lugares.length; i++) {
            // agregando un punto
            if(lugares[i].lat) {
               var marker = createMarker(lugares[i],iconGray);
               markers[i]=marker;

            }
         }  
      }
      
      $(".branch-widget .branch-nav li a").each(function(index){
         var lat = $(this).data("lat");
         var lng = $(this).data("lng");
         var title = $(this).find("h6").text();
         lugares[index] = new Object();
         lugares[index].lat = lat;
         lugares[index].lng = lng;
         lugares[index].title = title;
         lugares[index].index = index;
      });      
      
      populateMap(lugares);
      var principal = {'lat':lat,'lng':lng,'index':markers.length};
      
      markers.push(createMarker(principal,iconRed));
      
      function clearMarkers(){
         $(markers).each(function(){
            this.setIcon(iconGray);
         });
      }
      
      function setActive(marker,index){
            if(index==null){
               clearMarkers();
               marker.setIcon(iconRed);
               map.panTo(marker.getPosition());
            } else {
               if(index==(markers.length - 1)){
                  closeBranch();
               } else {
                  $(".branch-widget .branch-nav li a").eq(index).trigger('click');
               }
            }
      }
      
      function closeBranch(){
            $(".widget.map-widget h2 span").html(""); 
            index = markers.length - 1;
            setActive(markers[index],null);
            $('.ubicancion').effect('highlight',{},1000); 
            $(".branch-widget .branch-nav li a.activo").removeClass("activo");
      }
      
      
      function eventHandler(event){
         var lat = $(this).data("lat");
         var lng = $(this).data("lng");   
         var index = $(".branch-widget .branch-nav li a").index(this);
         var title = $(this).find("h6").text();
         var $target = $(event.target);
         $(".branch-widget .branch-nav li a.activo").removeClass("activo");
         if($target.is("span.close-banch")){
            // Mostrar Principal
            closeBranch();
         } else {
            // Mostrar sucursal  
            $(this).addClass("activo");
            $(".widget.map-widget h2 span").html(" : "+title);
            setActive(markers[index],null);
         }
         return false;  
      }
      
      $(".branch-widget .branch-nav li a").on('click',eventHandler);

      }

</script>
